# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json
# ============================================================================
# Azure Developer CLI (azd) Configuration
# ============================================================================
# This file configures the Azure Developer CLI for deploying the Fencemark
# .NET Aspire application to Azure Container Apps.
# ============================================================================

name: fencemark
metadata:
  template: fencemark@0.0.1

# ============================================================================
# Infrastructure Configuration
# ============================================================================

infra:
  provider: bicep
  path: infra
  module: main

# ============================================================================
# Services Configuration
# ============================================================================

services:
  apiservice:
    project: ./fencemark.ApiService
    host: containerapp
    language: dotnet

  webfrontend:
    project: ./fencemark.Web
    host: containerapp
    language: dotnet

# ============================================================================
# Hooks
# ============================================================================

hooks:
  postprovision:
    shell: pwsh
    run: |
      Write-Host "Enabling static website hosting on storage account..."
      $storageAccountName = azd env get-value staticSiteStorageAccountName
      if ($storageAccountName) {
        az storage blob service-properties update `
          --account-name $storageAccountName `
          --static-website `
          --index-document index.html `
          --404-document index.html `
          --auth-mode login
        Write-Host "Static website hosting enabled successfully" -ForegroundColor Green
      } else {
        Write-Host "Static site not deployed, skipping static website configuration" -ForegroundColor Yellow
      }

